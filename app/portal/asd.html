<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portal OS - Aplicaciones Embebidas</title>
  
  <!-- Tailwind CSS desde CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#f0f9ff',
              100: '#e0f2fe',
              200: '#bae6fd',
              300: '#7dd3fc',
              400: '#38bdf8',
              500: '#0ea5e9',
              600: '#0284c7',
              700: '#0369a1',
              800: '#075985',
              900: '#0c4a6e',
              950: '#082f49',
            },
          }
        }
      }
    }
  </script>
  
  <!-- React y ReactDOM desde CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel para JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- SHA256 para encriptación -->
  <script src="sha256.min.js"></script>
  
  <style>
    /* Estilos base que no dependen de Tailwind */
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }
    
    .app-container {
      height: calc(100vh - 64px);
    }
    
    iframe {
      border: none;
      width: 100%;
      height: 100%;
    }
    
    /* Animaciones */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .fade-in {
      animation: fadeIn 0.3s ease-in-out;
    }
    
    @keyframes slideIn {
      from { transform: translateX(-20px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    .slide-in {
      animation: slideIn 0.3s ease-in-out;
    }
    
    /* Transiciones */
    .transition-all {
      transition: all 0.3s ease;
    }

    /* Agregar estos estilos en la sección de estilos */
    @media (max-width: 640px) {
      .app-container {
        height: calc(100vh - 56px);
      }
      
      .sidebar-collapsed {
        width: 0;
      }
    }

    /* Estilos para tablets */
    @media (min-width: 641px) and (max-width: 1024px) {
      .sidebar-collapsed {
        width: 4rem;
      }
    }

    /* Transición suave para el sidebar */
    .sidebar-transition {
      transition: width 0.3s ease-in-out;
    }

    /* Estilos para los botones de acción */
    .app-action-button {
      opacity: 0.7;
      transition: opacity 0.2s ease-in-out;
    }

    .app-action-button:hover {
      opacity: 1;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <div id="portal-root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useRef, createContext, useContext } = React;
    // CORRECCIÓN: Obtener createPortal desde ReactDOM en lugar de React
    const { createPortal } = ReactDOM;
    
    // URLs de las aplicaciones
    const APPS = {
      admin: "https://script.google.com/macros/s/AKfycbycGaai__ENrHPpcJXFj6Dl2hL11HJ5eiVQkTnM3sYG2ggo01gxXvg7bvTDcQo3al8/exec",
      usuario: "https://script.google.com/macros/s/AKfycbzJ9lmty8W28vFCfcn-7grdyawGn8W5vubegNHOt1-ZkKx3ovkaXurjZS7zGuErfnMC/exec",
      general: "https://script.google.com/macros/s/AKfycbyhIKt6jtXg2UtyBbInpNW0l0dlrwRsBcuuUiaLTHWJPvoRCq98nbcZtc_1FhkSvJWeFg/exec"
    };
    
    // Contexto para el tema (claro/oscuro)
    const ThemeContext = createContext();
    
    const ThemeProvider = ({ children }) => {
      const [isDarkMode, setIsDarkMode] = useState(() => {
        const savedTheme = localStorage.getItem('theme');
        return savedTheme === 'dark';
      });
      
      useEffect(() => {
        if (isDarkMode) {
          document.documentElement.classList.add('dark');
          localStorage.setItem('theme', 'dark');
        } else {
          document.documentElement.classList.remove('dark');
          localStorage.setItem('theme', 'light');
        }
      }, [isDarkMode]);
      
      const toggleTheme = () => {
        setIsDarkMode(!isDarkMode);
      };
      
      return (
        <ThemeContext.Provider value={{ isDarkMode, toggleTheme }}>
          {children}
        </ThemeContext.Provider>
      );
    };
    
    // Hook para usar el tema
    const useTheme = () => useContext(ThemeContext);
    
    // Componente Modal usando React Portal
    const Modal = ({ isOpen, onClose, children, title }) => {
      if (!isOpen) return null;
      
      return createPortal(
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 fade-in">
          <div className="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-md w-full slide-in">
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-xl font-bold text-gray-900 dark:text-white">{title || 'Portal OS'}</h2>
              <button 
                onClick={onClose}
                className="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
              </button>
            </div>
            {children}
          </div>
        </div>,
        document.getElementById('portal-root')
      );
    };
    
    // Componente de Notificación
    const Notification = ({ message, type = 'info', onClose }) => {
      useEffect(() => {
        const timer = setTimeout(() => {
          onClose();
        }, 5000);
        
        return () => clearTimeout(timer);
      }, [onClose]);
      
      const bgColor = {
        success: 'bg-green-500',
        error: 'bg-red-500',
        warning: 'bg-yellow-500',
        info: 'bg-blue-500'
      };
      
      return createPortal(
        <div className={`fixed bottom-4 right-4 ${bgColor[type]} text-white p-4 rounded-lg shadow-lg z-50 slide-in`}>
          <div className="flex items-center">
            <span>{message}</span>
            <button 
              onClick={onClose} 
              className="ml-4 text-white hover:text-gray-200"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            </button>
          </div>
        </div>,
        document.getElementById('portal-root')
      );
    };
    
    // Componente de Formulario de Login
    const LoginForm = ({ onLogin }) => {
      const { isDarkMode } = useTheme();
      const [usuario, setUsuario] = useState('');
      const [clave, setClave] = useState('');
      const [error, setError] = useState('');
      const [loading, setLoading] = useState(false);
      const [showPassword, setShowPassword] = useState(false);
      
      const handleSubmit = async (e) => {
        e.preventDefault();
        
        if (!usuario || !clave) {
          setError('Por favor completa ambos campos');
          return;
        }
        
        setLoading(true);
        setError('');
        
        try {
          const hash = sha256(clave);
          
          // Usar la URL de autenticación existente
          const url = `https://script.google.com/macros/s/AKfycbwqcOlXMwjAKlLU_SFVbkrRrN2iQO2LnivaaOmG-5M3e8DX-vZ29oCGm2yza-zxIwZ9Ow/exec?usuario=${encodeURIComponent(usuario)}&hash=${encodeURIComponent(hash)}`;
          
          const response = await fetch(url);
          const data = await response.json();
          
          if (data && data.rol) {
            // Guardar datos del usuario en sessionStorage
            sessionStorage.setItem('usuario', JSON.stringify(data));
            
            // Inicializar historial de apps recientes
            if (!localStorage.getItem('recentApps')) {
              localStorage.setItem('recentApps', JSON.stringify([]));
            }
            
            onLogin(data);
          } else {
            setError('Credenciales incorrectas');
          }
        } catch (err) {
          console.error('Error al contactar al backend', err);
          setError('Error de conexión. Intenta nuevamente.');
        } finally {
          setLoading(false);
        }
      };
      
      return (
        <div className={`min-h-screen flex items-center justify-center ${isDarkMode ? 'bg-gray-900' : 'bg-gray-100'}`}>
          <div className="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md w-full max-w-md fade-in">
            <div className="text-center mb-6">
              <h2 className="text-2xl font-bold text-gray-900 dark:text-white">Portal OS</h2>
              <p className="text-gray-600 dark:text-gray-400 mt-1">Inicia sesión para acceder a tus aplicaciones</p>
            </div>
            
            {error && (
              <div className="bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-200 px-4 py-3 rounded mb-4">
                {error}
              </div>
            )}
            
            <form onSubmit={handleSubmit}>
              <div className="mb-4">
                <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2" htmlFor="usuario">
                  Usuario
                </label>
                <div className="relative">
                  <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-gray-400"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                  </div>
                  <input
                    id="usuario"
                    type="text"
                    className="pl-10 shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-600 leading-tight focus:outline-none focus:ring-2 focus:ring-primary-500"
                    value={usuario}
                    onChange={(e) => setUsuario(e.target.value)}
                    placeholder="Ingresa tu usuario"
                  />
                </div>
              </div>
              
              <div className="mb-6">
                <label className="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2" htmlFor="clave">
                  Contraseña
                </label>
                <div className="relative">
                  <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-gray-400"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                  </div>
                  <input
                    id="clave"
                    type={showPassword ? "text" : "password"}
                    className="pl-10 shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-600 leading-tight focus:outline-none focus:ring-2 focus:ring-primary-500"
                    value={clave}
                    onChange={(e) => setClave(e.target.value)}
                    placeholder="Ingresa tu contraseña"
                  />
                  <div className="absolute inset-y-0 right-0 pr-3 flex items-center">
                    <button
                      type="button"
                      onClick={() => setShowPassword(!showPassword)}
                      className="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none"
                    >
                      {showPassword ? (
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"/><line x1="2" x2="22" y1="2" y2="22"/></svg>
                      ) : (
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
                      )}
                    </button>
                  </div>
                </div>
              </div>
              
              <div className="flex items-center justify-between mb-4">
                <div className="flex items-center">
                  <input
                    id="remember"
                    type="checkbox"
                    className="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"
                  />
                  <label htmlFor="remember" className="ml-2 block text-sm text-gray-700 dark:text-gray-300">
                    Recordarme
                  </label>
                </div>
                
                <div className="text-sm">
                  <a href="#" className="text-primary-600 hover:text-primary-500 dark:text-primary-400">
                    ¿Olvidaste tu contraseña?
                  </a>
                </div>
              </div>
              
              <button
                type="submit"
                disabled={loading}
                className={`w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 ${loading ? 'opacity-70 cursor-not-allowed' : ''}`}
              >
                {loading ? (
                  <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                ) : null}
                Iniciar sesión
              </button>
            </form>
          </div>
        </div>
      );
    };
    
    // Componente de Cabecera
    const Header = ({ user, onLogout, toggleSidebar, sidebarOpen, sidebarCollapsed }) => {
      const { isDarkMode, toggleTheme } = useTheme();
      const [showUserMenu, setShowUserMenu] = useState(false);
      const userMenuRef = useRef(null);
      const [isMobile, setIsMobile] = useState(window.innerWidth < 768);
      
      useEffect(() => {
        const handleResize = () => {
          setIsMobile(window.innerWidth < 768);
        };
        
        window.addEventListener('resize', handleResize);
        return () => {
          window.removeEventListener('resize', handleResize);
        };
      }, []);
      
      useEffect(() => {
        const handleClickOutside = (event) => {
          if (userMenuRef.current && !userMenuRef.current.contains(event.target)) {
            setShowUserMenu(false);
          }
        };
        
        document.addEventListener('mousedown', handleClickOutside);
        return () => {
          document.removeEventListener('mousedown', handleClickOutside);
        };
      }, []);
      
      return (
        <header className="bg-white dark:bg-gray-800 shadow-md">
          <div className="px-4 py-3 flex justify-between items-center">
            <div className="flex items-center">
              <button
                onClick={toggleSidebar}
                className="mr-4 text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white focus:outline-none"
                aria-label={isMobile ? "Abrir/cerrar menú" : "Expandir/colapsar menú"}
              >
                {isMobile ? (
                  sidebarOpen ? (
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                  ) : (
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                  )
                ) : (
                  sidebarCollapsed ? (
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                  ) : (
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                  )
                )}
              </button>
              <h1 className="text-xl font-bold text-gray-900 dark:text-white">Portal OS</h1>
            </div>
            
            <div className="flex items-center space-x-4">
              <button
                onClick={toggleTheme}
                className="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none"
                aria-label="Cambiar tema"
              >
                {isDarkMode ? (
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
                ) : (
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
                )}
              </button>
              
              <button
                className="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none relative"
                aria-label="Notificaciones"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>
                <span className="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
              </button>
              
              <div className="relative" ref={userMenuRef}>
                <button
                  onClick={() => setShowUserMenu(!showUserMenu)}
                  className="flex items-center space-x-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white focus:outline-none"
                >
                  <div className="w-8 h-8 rounded-full bg-primary-500 flex items-center justify-center text-white">
                    {user.nombre.charAt(0).toUpperCase()}
                  </div>
                  <span className="hidden md:inline-block">{user.nombre}</span>
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                </button>
                
                {showUserMenu && (
                  <div className="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg py-1 z-10 fade-in">
                    <div className="px-4 py-2 border-b border-gray-200 dark:border-gray-700">
                      <p className="text-sm font-medium text-gray-900 dark:text-white">{user.nombre}</p>
                      <p className="text-xs text-gray-500 dark:text-gray-400">{user.email || 'usuario@ejemplo.com'}</p>
                      <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">Rol: {user.rol}</p>
                    </div>
                    <a href="#" className="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                      <div className="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mr-2"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        Mi perfil
                      </div>
                    </a>
                    <a href="#" className="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                      <div className="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mr-2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                        Configuración
                      </div>
                    </a>
                    <button
                      onClick={onLogout}
                      className="block w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700"
                    >
                      <div className="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mr-2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
                        Cerrar sesión
                      </div>
                    </button>
                  </div>
                )}
              </div>
            </div>
          </div>
        </header>
      );
    };
    
    // Componente de Barra Lateral
    const Sidebar = ({ user, onSelectApp, selectedApp, sidebarOpen, sidebarCollapsed }) => {
      const { isDarkMode } = useTheme();
      const [recentApps, setRecentApps] = useState([]);
      
      useEffect(() => {
        try {
          const savedRecentApps = JSON.parse(localStorage.getItem('recentApps')) || [];
          setRecentApps(savedRecentApps);
        } catch (error) {
          console.error('Error al cargar apps recientes:', error);
        }
      }, []);
      
      // Mapeo de nombres de aplicaciones
      const appNames = {
        admin: 'Administración',
        usuario: 'Panel de Usuario',
        general: 'App General'
      };
      
      // Mapeo de iconos de aplicaciones
      const appIcons = {
        admin: (
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M9 3v18"/><path d="M3 9h18"/></svg>
        ),
        usuario: (
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        ),
        general: (
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        )
      };
  
  // Determinar el ancho del sidebar según el estado
  const sidebarWidth = sidebarCollapsed ? "w-16" : "w-64";
  
  return (
    <div className={`fixed inset-y-0 left-0 z-30 ${sidebarWidth} bg-white dark:bg-gray-800 shadow-lg transform transition-all duration-300 ease-in-out ${sidebarOpen ? 'translate-x-0' : '-translate-x-full'} md:translate-x-0`}>
      <div className="h-full flex flex-col">
        <div className="p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-primary-500"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M7 7h10"/><path d="M7 12h10"/><path d="M7 17h10"/></svg>
          {!sidebarCollapsed && (
            <h2 className="ml-2 text-lg font-semibold text-gray-900 dark:text-white">Aplicaciones</h2>
          )}
        </div>
        
        {!sidebarCollapsed && (
          <div className="px-4 py-2">
            <div className="relative">
              <input
                type="text"
                placeholder="Buscar aplicación..."
                className="w-full pl-9 pr-3 py-2 text-sm bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"
              />
              <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-gray-400"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
              </div>
            </div>
          </div>
        )}

        <div className="flex-1 overflow-y-auto p-4">
          <div className="mb-6">
            {!sidebarCollapsed && (
              <h3 className="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">
                Menú Principal
              </h3>
            )}
            <ul className="space-y-1">
              <li>
                <button
                  onClick={() => onSelectApp('general')}
                  className={`w-full flex items-center px-3 py-2 text-sm rounded-md ${
                    selectedApp === 'general' 
                      ? 'bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-300' 
                      : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'
                  }`}
                  title={sidebarCollapsed ? appNames.general : ""}
                >
                  {appIcons.general}
                  {!sidebarCollapsed && <span className="ml-3">{appNames.general}</span>}
                </button>
              </li>
              
              {user.rol === 'admin' && (
                <li>
                  <button
                    onClick={() => onSelectApp('admin')}
                    className={`w-full flex items-center px-3 py-2 text-sm rounded-md ${
                      selectedApp === 'admin' 
                        ? 'bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-300' 
                        : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'
                    }`}
                    title={sidebarCollapsed ? appNames.admin : ""}
                  >
                    {appIcons.admin}
                    {!sidebarCollapsed && <span className="ml-3">{appNames.admin}</span>}
                  </button>
                </li>
              )}
              
              {(user.rol === 'usuario' || user.rol === 'admin') && (
                <li>
                  <button
                    onClick={() => onSelectApp('usuario')}
                    className={`w-full flex items-center px-3 py-2 text-sm rounded-md ${
                      selectedApp === 'usuario' 
                        ? 'bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-300' 
                        : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'
                    }`}
                    title={sidebarCollapsed ? appNames.usuario : ""}
                  >
                    {appIcons.usuario}
                    {!sidebarCollapsed && <span className="ml-3">{appNames.usuario}</span>}
                  </button>
                </li>
              )}
            </ul>
          </div>
          
          {recentApps.length > 0 && !sidebarCollapsed && (
            <div>
              <h3 className="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">
                Recientes
              </h3>
              <ul className="space-y-1">
                {recentApps.map((appKey, index) => (
                  <li key={index}>
                    <button
                      onClick={() => onSelectApp(appKey)}
                      className={`w-full flex items-center px-3 py-2 text-sm rounded-md ${
                        selectedApp === appKey 
                          ? 'bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-300' 
                          : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'
                      }`}
                    >
                      {appIcons[appKey]}
                      <span className="ml-3">{appNames[appKey]}</span>
                    </button>
                  </li>
                ))}
              </ul>
            </div>
          )}
        </div>
        
        {!sidebarCollapsed && (
          <div className="mt-auto">
            <div className="px-4 py-2">
              <h3 className="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">
                Ayuda y Soporte
              </h3>
              <ul className="space-y-1">
                <li>
                  <button
                    className="w-full flex items-center px-3 py-2 text-sm rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mr-2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
                    <span>Centro de Ayuda</span>
                  </button>
                </li>
                <li>
                  <button
                    className="w-full flex items-center px-3 py-2 text-sm rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mr-2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M16 13H8"/><path d="M16 17H8"/><path d="M10 9H8"/></svg>
                    <span>Documentación</span>
                  </button>
                </li>
              </ul>
            </div>
          </div>
        )}
        
        <div className="p-4 border-t border-gray-200 dark:border-gray-700">
          <div className="flex items-center">
            <div className="w-8 h-8 rounded-full bg-primary-500 flex items-center justify-center text-white">
              {user.nombre.charAt(0).toUpperCase()}
            </div>
            {!sidebarCollapsed && (
              <div className="ml-3">
                <p className="text-sm font-medium text-gray-900 dark:text-white">{user.nombre}</p>
                <p className="text-xs text-gray-500 dark:text-gray-400">Rol: {user.rol}</p>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
};
    
    // Componente de Contenido de la Aplicación
    const AppContent = ({ appKey, stats, user, onSelectApp }) => {
      const { isDarkMode } = useTheme();
      const iframeRef = useRef(null);
      const [isFullscreen, setIsFullscreen] = useState(false);
      const [isLoading, setIsLoading] = useState(false);
      
      // Función para refrescar el iframe
      const refreshApp = () => {
        if (iframeRef.current) {
          setIsLoading(true);
          iframeRef.current.src = iframeRef.current.src;
        }
      };
      
      // Detectar cuando el iframe termina de cargar
      const handleIframeLoad = () => {
        setIsLoading(false);
      };
      
      // Función para alternar pantalla completa
      const toggleFullscreen = () => {
        if (!document.fullscreenElement) {
          // Si no estamos en pantalla completa, entrar en pantalla completa
          if (iframeRef.current.requestFullscreen) {
            iframeRef.current.requestFullscreen();
            setIsFullscreen(true);
          } else if (iframeRef.current.webkitRequestFullscreen) { /* Safari */
            iframeRef.current.webkitRequestFullscreen();
            setIsFullscreen(true);
          } else if (iframeRef.current.msRequestFullscreen) { /* IE11 */
            iframeRef.current.msRequestFullscreen();
            setIsFullscreen(true);
          }
        } else {
          // Si ya estamos en pantalla completa, salir
          if (document.exitFullscreen) {
            document.exitFullscreen();
            setIsFullscreen(false);
          } else if (document.webkitExitFullscreen) { /* Safari */
            document.webkitExitFullscreen();
            setIsFullscreen(false);
          } else if (document.msExitFullscreen) { /* IE11 */
            document.msExitFullscreen();
            setIsFullscreen(false);
          }
        }
      };
      
      // Detectar cambios en el estado de pantalla completa
      useEffect(() => {
        const handleFullscreenChange = () => {
          setIsFullscreen(!!document.fullscreenElement);
        };
        
        document.addEventListener('fullscreenchange', handleFullscreenChange);
        document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
        document.addEventListener('mozfullscreenchange', handleFullscreenChange);
        document.addEventListener('MSFullscreenChange', handleFullscreenChange);
        
        return () => {
          document.removeEventListener('fullscreenchange', handleFullscreenChange);
          document.removeEventListener('webkitfullscreenchange', handleFullscreenChange);
          document.removeEventListener('mozfullscreenchange', handleFullscreenChange);
          document.removeEventListener('MSFullscreenChange', handleFullscreenChange);
        };
      }, []);
      
      // Función para manejar la selección de aplicaciones desde el dashboard
      const handleSelectApp = (appKey) => {
        if (onSelectApp) {
          onSelectApp(appKey);
        }
      };
      
      if (!appKey) return (
        <div className="h-full bg-gray-50 dark:bg-gray-900 p-6 overflow-auto">
          <div className="max-w-4xl mx-auto">
            <h1 className="text-2xl font-bold text-gray-900 dark:text-white mb-6">Dashboard</h1>
            
            {/* Estadísticas */}
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
              <div className="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                <div className="flex items-center">
                  <div className="p-3 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300 mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M7 7h10"/><path d="M7 12h10"/><path d="M7 17h10"/></svg>
                  </div>
                  <div>
                    <p className="text-sm font-medium text-gray-600 dark:text-gray-400">Apps Usadas</p>
                    <p className="text-2xl font-semibold text-gray-900 dark:text-white">{stats.appsUsadas}</p>
                  </div>
                </div>
              </div>
              
              <div className="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                <div className="flex items-center">
                  <div className="p-3 rounded-full bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-300 mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                  </div>
                  <div>
                    <p className="text-sm font-medium text-gray-600 dark:text-gray-400">Tiempo Total</p>
                    <p className="text-2xl font-semibold text-gray-900 dark:text-white">{stats.tiempoTotal}</p>
                  </div>
                </div>
              </div>
              
              <div className="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                <div className="flex items-center">
                  <div className="p-3 rounded-full bg-purple-100 dark:bg-purple-900 text-purple-600 dark:text-purple-300 mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0-18 0"/><path d="M12 7v5l3 3"/></svg>
                  </div>
                  <div>
                    <p className="text-sm font-medium text-gray-600 dark:text-gray-400">Último Acceso</p>
                    <p className="text-lg font-semibold text-gray-900 dark:text-white">{stats.ultimoAcceso}</p>
                  </div>
                </div>
              </div>
            </div>
            
            {/* Apps Recientes */}
            <div className="bg-white dark:bg-gray-800 rounded-lg shadow mb-8">
              <div className="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                <h2 className="text-lg font-medium text-gray-900 dark:text-white">Apps Recientes</h2>
              </div>
              <div className="p-6">
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  {JSON.parse(localStorage.getItem('recentApps') || '[]').map((appKey, index) => (
                    <button
                      key={index}
                      onClick={() => handleSelectApp(appKey)}
                      className="flex items-center p-4 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
                    >
                      <div className="p-2 rounded-md bg-primary-100 dark:bg-primary-900 text-primary-600 dark:text-primary-300 mr-3">
                        {appKey === 'admin' ? (
                          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M9 3v18"/><path d="M3 9h18"/></svg>
                        ) : appKey === 'usuario' ? (
                          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                        ) : (
                          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                        )}
                      </div>
                      <div className="text-left">
                        <h3 className="font-medium text-gray-900 dark:text-white">
                          {appKey === 'admin' ? 'Administración' : 
                           appKey === 'usuario' ? 'Panel de Usuario' : 'App General'}
                        </h3>
                        <p className="text-sm text-gray-500 dark:text-gray-400">Último acceso: hoy</p>
                      </div>
                    </button>
                  ))}
                  {JSON.parse(localStorage.getItem('recentApps') || '[]').length === 0 && (
                    <div className="col-span-3 text-center py-8 text-gray-500 dark:text-gray-400">
                      <p>No hay apps recientes. Selecciona una app del menú lateral para comenzar.</p>
                    </div>
                  )}
                </div>
              </div>
            </div>
            
            {/* Accesos Rápidos */}
            <div className="bg-white dark:bg-gray-800 rounded-lg shadow">
              <div className="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                <h2 className="text-lg font-medium text-gray-900 dark:text-white">Accesos Rápidos</h2>
              </div>
              <div className="p-6">
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                  <button
                    onClick={() => handleSelectApp('general')}
                    className="flex flex-col items-center p-4 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
                  >
                    <div className="p-3 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300 mb-3">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                    </div>
                    <span className="text-gray-900 dark:text-white font-medium">App General</span>
                  </button>
                  
                  {user && user.rol === 'admin' && (
                    <button
                      onClick={() => handleSelectApp('admin')}
                      className="flex flex-col items-center p-4 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
                    >
                      <div className="p-3 rounded-full bg-purple-100 dark:bg-purple-900 text-purple-600 dark:text-purple-300 mb-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M9 3v18"/><path d="M3 9h18"/></svg>
                      </div>
                      <span className="text-gray-900 dark:text-white font-medium">Administración</span>
                    </button>
                  )}
                  
                  {user && (user.rol === 'usuario' || user.rol === 'admin') && (
                    <button
                      onClick={() => handleSelectApp('usuario')}
                      className="flex flex-col items-center p-4 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
                    >
                      <div className="p-3 rounded-full bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-300 mb-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                      </div>
                      <span className="text-gray-900 dark:text-white font-medium">Panel de Usuario</span>
                    </button>
                  )}
                  
                  <button
                    className="flex flex-col items-center p-4 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
                  >
                    <div className="p-3 rounded-full bg-yellow-100 dark:bg-yellow-900 text-yellow-600 dark:text-yellow-300 mb-3">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M16 13H8"/><path d="M16 17H8"/><path d="M10 9H8"/></svg>
                    </div>
                    <span className="text-gray-900 dark:text-white font-medium">Documentación</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
      
      return (
        <div className="relative h-full flex flex-col border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden">
          {/* Barra de herramientas */}
          <div className="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-2 flex justify-between items-center">
            <h2 className="text-sm font-medium text-gray-700 dark:text-gray-300">
              {appKey === 'admin' ? 'Administración' : 
               appKey === 'usuario' ? 'Panel de Usuario' : 'App General'}
            </h2>
            <div className="flex space-x-2">
              <button
                onClick={refreshApp}
                className="p-1.5 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none"
                title="Refrescar aplicación"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M3 21v-5h5"/></svg>
              </button>
              <button
                onClick={toggleFullscreen}
                className="p-1.5 rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none"
                title={isFullscreen ? "Salir de pantalla completa" : "Ver en pantalla completa"}
              >
                {isFullscreen ? (
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8 3v4a1 1 0 0 1-1 1H3"/><path d="M16 3v4a1 1 0 0 0 1 1h4"/><path d="M8 21v-4a1 1 0 0 0-1-1H3"/><path d="M16 21v-4a1 1 0 0 1 1-1h4"/></svg>
                ) : (
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 8V5a2 2 0 0 1 2-2h3"/><path d="M21 8V5a2 2 0 0 0-2-2h-3"/><path d="M3 16v3a2 2 0 0 0 2 2h3"/><path d="M21 16v3a2 2 0 0 1-2 2h-3"/></svg>
                )}
              </button>
            </div>
          </div>
          
          {/* Contenedor del iframe */}
          <div className="relative flex-1">
            {isLoading && (
              <div className="absolute inset-0 flex items-center justify-center bg-gray-100 dark:bg-gray-800 bg-opacity-75 dark:bg-opacity-75 z-10">
                <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"></div>
              </div>
            )}
            <iframe 
              ref={iframeRef}
              src={APPS[appKey]} 
              title={`${appKey} App`}
              className="w-full h-full"
              onLoad={handleIframeLoad}
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen"
              allowFullScreen
            ></iframe>
          </div>
        </div>
      );
    };
    
    // Componente Principal de la Aplicación
    const App = () => {
      const [user, setUser] = useState(null);
      const [selectedApp, setSelectedApp] = useState(null);
      const [showWelcomeModal, setShowWelcomeModal] = useState(false);
      const [notification, setNotification] = useState(null);
      const [sidebarOpen, setSidebarOpen] = useState(false);
      const [sidebarCollapsed, setSidebarCollapsed] = useState(false); // Nuevo estado para el modo colapsado
      const [stats, setStats] = useState({
        appsUsadas: 0,
        tiempoTotal: '0h 0m',
        ultimoAcceso: 'Nunca'
      });
      
      // Verificar sesión existente al cargar
      useEffect(() => {
        const storedUser = sessionStorage.getItem('usuario');
        if (storedUser) {
          const userData = JSON.parse(storedUser);
          setUser(userData);
          setShowWelcomeModal(true);
        }
      }, []);
      
      const handleLogin = (userData) => {
        setUser(userData);
        setShowWelcomeModal(true);
        showNotification('Inicio de sesión exitoso', 'success');
      };
      
      const handleLogout = () => {
        // Limpiar sessionStorage y reiniciar estado
        sessionStorage.removeItem('usuario');
        setUser(null);
        setSelectedApp(null);
        showNotification('Sesión cerrada correctamente', 'info');
      };
      
      const handleSelectApp = (appKey) => {
        setSelectedApp(appKey);
        
        // Actualizar estadísticas
        setStats(prevStats => ({
          appsUsadas: prevStats.appsUsadas + 1,
          tiempoTotal: '2h 15m', // Esto sería calculado en una implementación real
          ultimoAcceso: new Date().toLocaleString()
        }));
        
        // Guardar en historial de apps recientes
        try {
          const recentApps = JSON.parse(localStorage.getItem('recentApps')) || [];
          
          // Eliminar si ya existe y añadir al principio
          const filteredApps = recentApps.filter(app => app !== appKey);
          const newRecentApps = [appKey, ...filteredApps].slice(0, 3); // Mantener solo las 3 más recientes
          
          localStorage.setItem('recentApps', JSON.stringify(newRecentApps));
        } catch (error) {
          console.error('Error al guardar app reciente:', error);
        }
      };
      
      const showNotification = (message, type = 'info') => {
        setNotification({ message, type });
      };
      
      const toggleSidebar = () => {
        // En móvil, abre/cierra el sidebar
        // En desktop, colapsa/expande el sidebar
        if (window.innerWidth < 768) {
          setSidebarOpen(!sidebarOpen);
        } else {
          setSidebarCollapsed(!sidebarCollapsed);
        }
      };
      
      if (!user) {
        return (
          <ThemeProvider>
            <LoginForm onLogin={handleLogin} />
          </ThemeProvider>
        );
      }
      
      return (
        <ThemeProvider>
          <div className="flex flex-col h-screen bg-gray-100 dark:bg-gray-900">
            <Header 
              user={user} 
              onLogout={handleLogout} 
              toggleSidebar={toggleSidebar}
              sidebarOpen={sidebarOpen}
              sidebarCollapsed={sidebarCollapsed}
            />
            
            <div className="flex flex-1 overflow-hidden">
              <Sidebar 
                user={user} 
                onSelectApp={handleSelectApp} 
                selectedApp={selectedApp}
                sidebarOpen={sidebarOpen}
                sidebarCollapsed={sidebarCollapsed}
              />
              
              <main className={`flex-1 overflow-hidden transition-all duration-300 ${sidebarCollapsed ? 'md:ml-16' : 'md:ml-64'}`}>
                <AppContent 
                  appKey={selectedApp} 
                  stats={stats} 
                  user={user} 
                  onSelectApp={handleSelectApp}
                />
              </main>
            </div>
            
            {sidebarOpen && window.innerWidth < 768 && (
              <div 
                className="fixed inset-0 bg-black bg-opacity-50 z-20"
                onClick={() => setSidebarOpen(false)}
                aria-hidden="true"
              />
            )}
            
            {/* Modal de bienvenida */}
            <Modal 
              isOpen={showWelcomeModal} 
              onClose={() => setShowWelcomeModal(false)}
              title="¡Bienvenido a Portal OS!"
            >
              <div className="text-center">
                <div className="mb-4 flex justify-center">
                  <div className="w-16 h-16 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center text-primary-600 dark:text-primary-300">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 9a2 2 0 0 1-2 2H6l-4 4V4c0-1.1.9-2 2-2h8a2 2 0 0 1 2 2v5Z"/><path d="M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1"/></svg>
                  </div>
                </div>
                <h3 className="text-lg font-medium mb-2 text-gray-900 dark:text-white">
                  Hola, {user.nombre}
                </h3>
                <p className="mb-4 text-gray-600 dark:text-gray-400">
                  Has iniciado sesión como <strong>{user.rol}</strong>. Ahora puedes acceder a tus aplicaciones desde el menú lateral.
                </p>
                <div className="mb-4 p-3 bg-gray-100 dark:bg-gray-700 rounded-lg text-left">
                  <h4 className="text-sm font-medium mb-2 text-gray-900 dark:text-white">Novedades en Portal OS:</h4>
                  <ul className="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                    <li className="flex items-center">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-green-500 mr-2"><polyline points="20 6 9 17 4 12"/></svg>
                      Tema claro/oscuro
                    </li>
                    <li className="flex items-center">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-green-500 mr-2"><polyline points="20 6 9 17 4 12"/></svg>
                      Barra lateral mejorada
                    </li>
                    <li className="flex items-center">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-green-500 mr-2"><polyline points="20 6 9 17 4 12"/></svg>
                      Historial de aplicaciones recientes
                    </li>
                  </ul>
                </div>
                <button
                  onClick={() => setShowWelcomeModal(false)}
                  className="bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded transition-colors"
                >
                  Comenzar
                </button>
              </div>
            </Modal>
            
            {/* Notificaciones */}
            {notification && (
              <Notification
                message={notification.message}
                type={notification.type}
                onClose={() => setNotification(null)}
              />
            )}
          </div>
        </ThemeProvider>
      );
    };
    
    // Renderizar la aplicación
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
